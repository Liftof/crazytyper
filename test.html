<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrazyTyper PDF Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .test-results { background: white; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .log { margin: 5px 0; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        #test-frame { width: 100%; height: 600px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>üß™ Tests automatiques CrazyTyper PDF</h1>
    
    <div class="test-results">
        <h2>üìã R√©sultats des tests:</h2>
        <div id="test-logs">
            <div class="log info">‚è≥ Chargement des tests...</div>
        </div>
    </div>

    <div class="test-results">
        <h2>üñºÔ∏è Application en cours de test:</h2>
        <iframe id="test-frame" src="http://localhost:8080"></iframe>
    </div>

    <script>
        const logs = document.getElementById('test-logs');
        
        function addLog(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            logs.appendChild(div);
            console.log(message);
        }

        // √âcouter les messages de l'iframe
        window.addEventListener('message', (event) => {
            if (event.data.type === 'test-log') {
                addLog(event.data.message, event.data.level || 'info');
            }
        });

        // Attendre que l'iframe se charge et injecter les tests
        document.getElementById('test-frame').onload = function() {
            addLog('üì± Application charg√©e', 'success');
            
            setTimeout(() => {
                try {
                    const iframe = document.getElementById('test-frame');
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    // Injecter le script de test
                    const script = iframeDoc.createElement('script');
                    script.textContent = `
                        console.log('üß™ Tests PDF inject√©s');
                        
                        // Override console pour envoyer les logs au parent
                        const originalLog = console.log;
                        const originalError = console.error;
                        
                        console.log = function(...args) {
                            originalLog(...args);
                            window.parent.postMessage({
                                type: 'test-log',
                                message: args.join(' '),
                                level: 'success'
                            }, '*');
                        };
                        
                        console.error = function(...args) {
                            originalError(...args);
                            window.parent.postMessage({
                                type: 'test-log', 
                                message: args.join(' '),
                                level: 'error'
                            }, '*');
                        };
                        
                        // Tests
                        setTimeout(() => {
                            console.log('üîç Test 1: V√©rification jsPDF');
                            if (typeof window.jspdf !== 'undefined') {
                                console.log('‚úÖ jsPDF trouv√©');
                                
                                // Test cr√©ation PDF simple
                                try {
                                    const { jsPDF } = window.jspdf;
                                    const doc = new jsPDF();
                                    doc.text('Test PDF', 10, 10);
                                    console.log('‚úÖ Instance jsPDF cr√©√©e avec succ√®s');
                                    
                                    // Test avec texte dans l'output
                                    const output = document.querySelector('.typewriter-output');
                                    if (output) {
                                        output.innerHTML = 'Test de g√©n√©ration PDF avec CrazyTyper';
                                        document.getElementById('outputSection').classList.remove('hidden');
                                        console.log('‚úÖ Texte test ajout√©');
                                        
                                        // Test export complet
                                        setTimeout(() => {
                                            try {
                                                if (typeof exportToPDF === 'function') {
                                                    console.log('‚úÖ Fonction exportToPDF trouv√©e');
                                                    console.log('üéØ Test export PDF...');
                                                    exportToPDF();
                                                    console.log('‚úÖ Export PDF termin√© sans erreur');
                                                } else {
                                                    console.error('‚ùå Fonction exportToPDF non trouv√©e');
                                                }
                                            } catch (error) {
                                                console.error('‚ùå Erreur export:', error.message);
                                            }
                                        }, 500);
                                        
                                    } else {
                                        console.error('‚ùå Element output non trouv√©');
                                    }
                                    
                                } catch (error) {
                                    console.error('‚ùå Erreur cr√©ation jsPDF:', error.message);
                                }
                                
                            } else {
                                console.error('‚ùå jsPDF non charg√©');
                            }
                        }, 1000);
                    `;
                    
                    iframeDoc.head.appendChild(script);
                    addLog('üîß Tests inject√©s dans l\'application', 'info');
                    
                } catch (error) {
                    addLog('‚ùå Erreur injection tests: ' + error.message, 'error');
                }
            }, 2000);
        };
        
        addLog('üöÄ Test harness initialis√©', 'info');
    </script>
</body>
</html>